{% extends "base.html" %} {% load static %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container py-4">
  <h1>Make a Booking</h1>

  <!-- GET form just for selecting category -->
  <form method="get">
    {{ form.category|as_crispy_field }}
  </form>

  <!-- auto-submit select fields -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const catSelect = document.querySelector('select[name="category"]');
      if (catSelect) {
        catSelect.addEventListener("change", function () {
          this.form.submit();
        });
      }
      const treatSelect = document.querySelector('select[name="treatment"]');
      if (treatSelect) {
        treatSelect.addEventListener("change", function () {
          this.form.submit();
        });
      }
    });
  </script>

  <!-- POST booking form -->
  <form method="post" novalidate>
    {% csrf_token %}
    <!-- hidden field to carry category into POST form -->
    <input type="hidden" name="category" value="{{ category_id }}">

    {{ form.treatment|as_crispy_field }}
    {{ form.availability|as_crispy_field }}
    {{ form.notes|as_crispy_field }}

    <button type="submit" class="btn btn-primary book-btn" disabled>Book Now</button>
  </form>

  <!-- disable submit button until availability selected -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const availabilityField = document.querySelector('select[name="availability"]');
      const submitBtn = document.querySelector('button[type="submit"]');
      function toggleBtn() { submitBtn.disabled = !availabilityField.value; }
      toggleBtn();
      availabilityField.addEventListener('change', toggleBtn);
    });
  </script>
</div>
{% endblock %}
